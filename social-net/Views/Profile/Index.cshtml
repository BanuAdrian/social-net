@using Microsoft.AspNetCore.Identity
@model social_net.Models.User
@{
}

@inject SignInManager<User> SignInManager
@inject UserManager<User> UserManager

<h1>@Model.FirstName @Model.LastName</h1>

@if (SignInManager.IsSignedIn(User))
{
	var currentUser = await UserManager.GetUserAsync(User);
	if (currentUser == Model)
	{
		<a id="manage" class="nav-link text-dark" asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">Edit Account</a>
		<h3>Create post</h3>
		<form asp-action="CreatePost" asp-route-currentUserId="@currentUser.Id" method="post">
			<div class="form-floating mb-3">
				<input class="form-control" name="textContent" autocomplete="off" />
				<label>What's on your mind, @currentUser.FirstName?</label>
			</div>
		</form>

		<h3>Create album</h3>
		<form asp-action="CreateAlbum" asp-route-currentUserId="@currentUser.Id" method="post" enctype="multipart/form-data">
			<input type="file" name="photos" class="form-control" multiple />
			<button type="submit" class="btn btn-primary">Create Album</button>
		</form>
	} else
	{
		if (Model.AllFriendships.Any(fr => fr.InitiatorUserId == currentUser.Id || fr.RecipientUserId == currentUser.Id))
		{
			<p> You are friends! </p>
			@* <button class="btn btn-primary" asp-controller="Message" asp-action="Index" asp-route-profileUserId="@Model.Id">Message</button> *@
			<a class="btn btn-primary" asp-action="MessageBox" asp-route-profileUserId="@Model.Id">Message</a>
		}
		else
		{
			if (Model.ReceivedFriendRequests.Any(fr => fr.SenderId == currentUser.Id))
			{
				<p> Ai trimis o cerere de prietenie acestui utilizator. </p>
			}
			else if (Model.SentFriendRequests.Any(fr => fr.ReceiverId == currentUser.Id))
			{
				@* <p> Ai primit o cerere de prietenie de la acest utilizator. </p> *@

				<form asp-action="AcceptFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
					<button type="submit" class="btn btn-primary">Accept Friend</button>
				</form>

				<form asp-action="DeclineFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
					<button type="submit" class="btn btn-primary">Decline Friend</button>
				</form>
			}
			else
			{
				<form asp-action="AddFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
					<button type="submit" class="btn btn-primary">Add Friend</button>
				</form>
			}
		}
	}

	if (User.IsInRole("Admin") || currentUser == Model || Model.HasPublicProfile || Model.Friends.Contains(currentUser))
	{
		<partial name="_ProfilePartial" />

	}
}
else if (Model.HasPublicProfile)
{
	<partial name="_ProfilePartial" />

} else 
{
	<h5>This user has a private profile</h5>
}
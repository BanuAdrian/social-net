@using Microsoft.AspNetCore.Identity
@model social_net.Models.User
@{
}

@inject UserManager<User> UserManager

@{
	var currentUser = await UserManager.GetUserAsync(User);
}

<h1>@Model.FirstName @Model.LastName</h1>

@if (currentUser == Model)
{
	<a id="manage" class="nav-link text-dark" asp-area="Identity" asp-page="/Account/Manage/Index" title="Manage">Edit Account</a>
	<h3>Create post</h3>
	<form asp-action="CreatePost" asp-route-currentUserId="@currentUser.Id" method="post">
		<div class="form-floating mb-3">
			<input class="form-control" name="textContent" autocomplete="off" />
			<label>What's on your mind, @currentUser.FirstName?</label>
		</div>
	</form>
}
else if (currentUser != null)
{
	/*
	Console.WriteLine("profileUser.ReceivedFriendRequests = ");
	foreach (var friendRequest in @Model.ReceivedFriendRequests)
	{
		Console.WriteLine("ID = " + friendRequest.ReceiverId);
		}
	*/
	if (Model.AllFriendships.Any(fr => fr.InitiatorUserId == currentUser.Id || fr.RecipientUserId == currentUser.Id))
	{
		<p> You are friends! </p>
		@* <button class="btn btn-primary" asp-controller="Message" asp-action="Index" asp-route-profileUserId="@Model.Id">Message</button> *@
		<a class="btn btn-primary" asp-action="MessageBox" asp-route-profileUserId="@Model.Id">Message</a>
	}
	else
	{
		if (Model.ReceivedFriendRequests.Any(fr => fr.SenderId == currentUser.Id))
		{
			<p> Ai trimis o cerere de prietenie acestui utilizator. </p>
		}
		else if (Model.SentFriendRequests.Any(fr => fr.ReceiverId == currentUser.Id))
		{
			@* <p> Ai primit o cerere de prietenie de la acest utilizator. </p> *@

			<form asp-action="AcceptFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
				<button type="submit" class="btn btn-primary">Accept Friend</button>
			</form>

			<form asp-action="DeclineFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
				<button type="submit" class="btn btn-primary">Decline Friend</button>
			</form>
		}
		else
		{
			<form asp-action="AddFriend" asp-route-profileUserId="@Model.Id" asp-route-currentUserId="@currentUser.Id" method="post">
				<button type="submit" class="btn btn-primary">Add Friend</button>
			</form>
		}
	}



}

<h3>Posts</h3>
@foreach (var textPost in Model.TextPosts)
{
	<div style="border: 1px solid black; margin-bottom: 25px; padding: 10px; border-radius: 10px">
		<h4>@Model.FirstName @Model.LastName</h4>
		<p>@textPost.PostedAt</p>
		<p>@textPost.Text</p>
	</div>
}
